<script>
  document.addEventListener("DOMContentLoaded", () => {
    const pv = document.getElementById("pageviews");
    if (pv !== null) {
      const uri = location.pathname.replace(/\/$/, "");
      const goatId = '{{ site.analytics.goatcounter.id | default: "" }}';
      const url = `https://${goatId}.goatcounter.com/counter/${encodeURIComponent(
        uri
      )}.json`;

      fetch(url)
        .then((response) => response.json())
        .then((data) => {
          const count = (data.count || "0").toString().replace(/\s/g, "");
          pv.innerText = new Intl.NumberFormat().format(count);
        })
        .catch(() => {
          pv.innerText = "1";
        });
    }
  });
</script>
